<mat-card>
  <div class="table-controls">
    <button mat-flat-button color="primary" (click)="addNewItem()">Add</button>
    <button mat-flat-button color="accent" (click)="saveRelationshipData()">
      Save
    </button>
    <mat-slide-toggle
      class="example-margin"
      [checked]="readOnly"
      (toggleChange)="toggleReadOnly(!readOnly)"
    >
      Toggle Readonly
    </mat-slide-toggle>
  </div>
  <div style="overflow: auto">
    <table
      mat-table
      [dataSource]="dataSource"
      cdkDropList
      [cdkDropListData]="dataSource"
      (cdkDropListDropped)="dropTable($event)"
      matSort
      (matSortChange)="sortData($event)"
    >
      <ng-container
        [matColumnDef]="column"
        *ngFor="let column of displayedColumns"
      >
        <th mat-header-cell mat-sort-header *matHeaderCellDef cdkDrag>
          {{ displayedColumnsLabels[column] }}
        </th>
        <td mat-cell *matCellDef="let element; let i = index">
          <ng-container *ngIf="element[column].type == CONTROL_TYPE.Text">
            <app-text-input
              [(value)]="element[column].value"
              [readOnly]="element['readOnly']"
            ></app-text-input>
          </ng-container>

          <ng-container *ngIf="element[column].type == CONTROL_TYPE.DropDown">
            <app-list-input
              [(value)]="element[column].value"
              [readOnly]="element['readOnly']"
              [options]="element[column].options"
            ></app-list-input>
          </ng-container>

          <ng-container *ngIf="element[column].type == CONTROL_TYPE.Date">
            <app-date-input
              [(value)]="element[column].value"
              [readOnly]="element['readOnly']"
            ></app-date-input>
          </ng-container>

          <ng-container *ngIf="element[column].type == CONTROL_TYPE.CheckBox">
            <app-checkbox-input
              [(value)]="element[column].value"
              [readOnly]="element['readOnly']"
            ></app-checkbox-input>
          </ng-container>

          <!-- TBD -->
          <ng-container *ngIf="element[column].type == CONTROL_TYPE.Image">
            <app-image-renderer
              [(value)]="element[column].value"
              [readOnly]="element['readOnly']"
            ></app-image-renderer>
          </ng-container>

          <!-- TBD -->
          <ng-container *ngIf="element[column].type == CONTROL_TYPE.RichText">
            <section class="example-section" style="text-align: center">
              <div
                style="width: 150px; height: 20px"
                (click)="
                  !element['readOnly'] &&
                    onRichtextClick(element[column].data, i)
                "
                [froalaView]="element[column].data"
              ></div>
            </section>
          </ng-container>

          <!-- TBD -->
          <ng-container *ngIf="element[column].type == CONTROL_TYPE.Item">
            <!-- <form class="example-form" *ngIf="!element['readOnly']">
          <mat-form-field class="example-full-width" appearance="fill">
        <span *ngIf="element['readOnly']">{{ element[column].data }}</span>

            <input
              matInput
              [value]="element[column].data"
              style="width: 100px"
              (click)="onItemClick(element[column].data, i)"
            />
          </mat-form-field>
      
        </form> -->
            <div style="display: flex; align-items: center">
              <mat-icon
                aria-hidden="false"
                *ngIf="!element['readOnly']"
                (click)="onItemClick(element[column].data, i)"
              >
                library_add
              </mat-icon>

              <mat-icon aria-hidden="false" *ngIf="!element['readOnly']">
                delete
              </mat-icon>

              <span>{{ element[column].data }}</span>
            </div>
          </ng-container>

          <!-- TBD -->
          <ng-container *ngIf="element[column].type == CONTROL_TYPE.File">
            <div
              class="example-card"
              style="position: relative; display: flex; justify-content: center"
            >
              <span>{{ element[column].value }}</span>
              <div [style.display]="element[column].value ? 'block' : 'none'">
                <mat-icon
                  aria-hidden="false"
                  (click)="onFilePickerDialog(element[column])"
                  *ngIf="!element['readOnly']"
                >
                  file_upload</mat-icon
                >
                <mat-icon aria-hidden="false" *ngIf="!element['readOnly']">
                  file_download</mat-icon
                >
                <mat-icon aria-hidden="false" *ngIf="!element['readOnly']">
                  delete</mat-icon
                >
              </div>

              <mat-icon
                [style.display]="element[column].value ? 'none' : 'block'"
                aria-hidden="false"
                (click)="onFilePickerDialog(element[column])"
                *ngIf="!element['readOnly']"
              >
                file_upload</mat-icon
              >
              <!-- style="margin-right: 35%" -->
            </div>
          </ng-container>

          <ng-container *ngIf="element[column].type == 'action'">
            <a (click)="onRowEditStart(element)" *ngIf="element.readOnly">
              <span class="material-icons">edit</span>
            </a>
            <a (click)="onRowEditDone(element)" *ngIf="!element.readOnly">
              <span class="material-icons">done</span>
            </a>
            <a (click)="onRowDelete(element)">
              <span class="material-icons">delete</span>
            </a>
          </ng-container>
        </td>
        <td mat-footer-cell *matFooterCellDef>
          <ng-container *ngIf="column == 'symbol'"
            >Aggregate row!!</ng-container
          >
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        [class.hidden]="row.action.value === 'delete'"
        cdkDrag
        [cdkDragData]="row"
      ></tr>
    </table>
  </div>
</mat-card>
